
<app-progress-bar></app-progress-bar>

@if (notification.isFound) {
    <app-notification [attr.role]="notification.status">{{notification.message}}</app-notification>
}
 
<div class="bg-gradient-to-r from-indigo-800 to-blue-900 min-h-screen flex items-center justify-center p-4">
    <div class="font-std mb-10 w-full rounded-2xl bg-white p-3 sm:p-10 font-normal leading-relaxed text-gray-900 shadow-xl">
       @if (loading) {
        <app-loader></app-loader>
       } @else {
            <div class="grid grid-cols-3 -mb-32 items-start">
                <h2 class=" col-span-3 mb-5 text-xl sm:text-4xl font-bold text-blue-900">Update Profile</h2>

                <!-- Update your profile Background. -->

                <form (ngSubmit)="onUpdateBackground()" class="col-span-3">
                <div class="text-center">
                    <div class="relative w-full aspect-[16/9] sm:h-96">
                        @if (background_url) {
                            <img [src]="background_url" alt="Profile Picture" class="rounded-2xl w-full sm:w-3/4 h-full object-cover mx-auto border-4 border-indigo-800 mb-4 transition-transform duration-300 hover:scale-105">
                        }
                        @else {
                            <img src="photo\white-2172682_1920.jpg" alt="Profile Picture" class="rounded-2xl w-full sm:w-3/4 h-full object-cover mx-auto border-4 border-indigo-800 mb-4 transition-transform duration-300 hover:scale-105">
                        }
                        <input type="file" name="background" id="upload_background" hidden (change)="onBackgroundSelect($event)" accept="image/*">

                        <label for="upload_background" class="inline-flex items-center relative -top-10 sm:-top-14 cursor-pointer">
                            <svg data-slot="icon" class="w-4 h-4 sm:w-7 sm:h-7 text-white" fill="blue" stroke-width="1.5"
                                stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z">
                                </path>
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z">
                                </path>
                            </svg>
                        </label>
                    </div>
                </div>
                </form>
                
                <!-- Update your profile picture. -->
                <form (ngSubmit)="onSubmit()" class="col-span-1 relative -top-20 left-5 sm:left-20">
                <div class="text-center">
                    <div>
                        @if (image_url) {
                            <img [src]="image_url" alt="Profile Picture" class="rounded-full sm:w-32 sm:h-32 mx-auto border-4 border-indigo-800 mb-4 transition-transform duration-300 hover:scale-105">
                        }
                        @else {
                            <img src="photo/user.png" alt="Profile Picture" class="rounded-full sm:w-32 sm:h-32 mx-auto border-4 border-indigo-800 mb-4 transition-transform duration-300 hover:scale-105">
                        }
                        <input type="file" name="profile" id="upload_profile" hidden (change)="onFileSelect($event)" accept="image/*">

                        <label for="upload_profile" class="inline-flex items-center relative bottom-10 sm:bottom-14 cursor-pointer">
                            <svg data-slot="icon" class="w-4 h-4 sm:w-7 sm:h-7 text-white" fill="blue" stroke-width="1.5"
                                stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"
                                aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z">
                                </path>
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z">
                                </path>
                            </svg>
                        </label>
                    </div>
                </div>
                </form>
            </div>
            
            <!-- Update profile Info -->
              @if(!addInfo){
                <!-- Update profile name -->
                 <h2 class="mt-10 font-bold mb-3">Update Your Name</h2>
                <form class="grid grid-cols-1 sm:grid-cols-5 sm:gap-x-10 items-center sm:border sm:rounded-lg sm:p-10" (ngSubmit)="onUpdateName()">
                    <div class="col-span-1 sm:col-span-2 ">
                        <label for="first_name" class="block text-sm font-medium text-gray-700">First Name</label>
                        <input type="text" id="first_name" name="first_name" [(ngModel)]="first_name" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div class="col-span-1 sm:col-span-2">
                        <label for="last_name" class="block text-sm font-medium text-gray-700">Last Name</label>
                        <input type="text" id="last_name" name="last_name" [(ngModel)]="last_name" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div class="col-span-1 text-center sm:text-start">
                        <button type="submit" [disabled]="!first_name || !last_name" >Update</button>
                    </div>
                </form>
              }
                <!-- Update profile description -->
                 <h2 class="mt-10 font-bold mb-3">Update Your Description</h2>
                <form (ngSubmit)="onUpdateDesc()" class="grid grid-cols-1 sm:grid-cols-5 sm:gap-x-10 items-center sm:border sm:rounded-lg sm:p-10">
                    <div class="col-span-1 sm:col-span-4">
                        <label for="title" class="block text-sm font-medium text-gray-700">Description</label>
                        <input type="text" id="title" name="description" [(ngModel)]="description" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div class="col-span-1 text-center sm:text-start">
                        <button type="submit" [disabled]="!description" >Update</button>
                    </div>
                </form>
                @if(role == "company"){
                <!-- Update profile Location -->
                 <h2 class="mt-10 font-bold mb-3">Update Your Location</h2>
                <form (ngSubmit)="onUpdateLocation()" class="grid grid-cols-1 sm:grid-cols-5 sm:gap-x-10 items-center sm:border sm:rounded-lg sm:p-10">
                    <div class="col-span-1 sm:col-span-4">
                        <label for="location" class="block text-sm font-medium text-gray-700">Location</label>
                        <input type="text" id="location" name="description" [(ngModel)]="location" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div class="col-span-1 text-center sm:text-start">
                        <button type="submit" [disabled]="!location" >Update</button>
                    </div>
                </form>
              }
                @if(!addInfo){
                <!-- Update profile password -->
                <h2 class="mt-10 font-bold mb-3">Update Profile Password</h2>
                <form class="grid grid-cols-1 md:grid-cols-4 sm:gap-x-10 items-center sm:border sm:rounded-lg sm:p-10" [formGroup]="changePasswordForm" (ngSubmit)="onUpdatePassword()">
                    <div class="col-span-1 sm:col-span-2">
                        <label for="current_password" class="block text-sm font-medium text-gray-700">Current Password</label>
                        <input type="password" id="current_password" formControlName="old_password"  class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                        <div
                        *ngIf="!changePasswordForm.get('current_password')?.errors?.['required'] &&
                          changePasswordForm.get('current_password')?.touched &&
                          changePasswordForm.get('current_password')?.errors?.['minlength']"
                        class="text-sm text-violet-600 mt-1 font-bold"
                      >
                        Password must be at least 8 Characters
                      </div>
                    </div>
                    <div class="col-span-1 sm:col-span-2">
                        <label for="password" class="block text-sm font-medium text-gray-700">New Password</label>
                        <input type="password" id="password" formControlName="password" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                        <div
                        *ngIf="!changePasswordForm.get('password')?.errors?.['required'] &&
                          changePasswordForm.get('password')?.touched &&
                          changePasswordForm.get('password')?.errors?.['minlength']"
                        class="text-sm text-violet-600 mt-1 font-bold"
                      >
                        Password must be at least 8 Characters
                      </div>
                    </div>
                    <div class="col-span-1 sm:col-span-2">
                        <label for="password_confirmation" class="block text-sm font-medium text-gray-700">Confirm New Password</label>
                        <input type="password" id="password_confirmation" formControlName="password_confirmation" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                        <div
                            *ngIf="(changePasswordForm.hasError('passwordMismatch') &&
                            changePasswordForm.get('password_confirmation')?.touched &&
                            !changePasswordForm.get('password_confirmation')?.errors?.['required'])"
                            class="text-sm text-red-600 mt-1"
                        >
                            Passwords do not match.
                        </div>
                    </div>
                    <div class="col-span-1 text-center sm:text-start">
                        <button type="submit" [disabled]="changePasswordForm.invalid" >Update</button>
                    </div>
                </form>
              }
              @if(role == 'user'){
                <!-- Update Your CV -->
                <h2 class="mt-10 font-bold mb-3">Update Your CV</h2>
                <form (ngSubmit)="onUpdateCV()" #cvForm="ngForm" class="grid grid-cols-1 sm:grid-cols-5 sm:gap-x-10 items-center sm:border sm:rounded-lg sm:p-10">
                    <div class="col-span-1 sm:col-span-4">

                        <label for="cv" class="sr-only">Choose file</label>
                        <input type="file" name="cv" id="cv" (change)="onCVSelect($event)" accept=".pdf,.doc,.docx" class="block w-full border border-gray-200 shadow-sm rounded-lg text-sm focus:z-10 focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none
                            file:bg-indigo-600 file:border-0
                            file:text-white
                            file:me-4
                            file:py-3 file:px-4"
                        >
                    </div>
                    <div class="col-span-1 text-center sm:text-start mt-4 sm:mt-0"> 
                        <button type="submit" [disabled]="!cvFile" >Update</button>
                    </div>
                </form>

                <!-- Update Your Skills -->
                <h2 class="mt-10 font-bold mb-3">Update Your Job And Skills</h2>

                <!-- add-skills-modal.component.html -->
                  <form [formGroup]="form" (ngSubmit)="onUpdateSkillsAndJob()" class="bg-white sm:border sm:rounded-lg w-full sm:p-10">
                
                    <!-- Job Profile -->
                    <div class="mb-6">
                      <label class="block text-sm font-medium text-gray-700 mb-2">Job Profile</label>
                      <div class="flex flex-wrap gap-2 h-60 overflow-auto bg-slate-50">
                        <button 
                          type="button"
                          *ngFor="let profile of allJobs"
                          (click)="selectjob_id(profile)"
                          class="p-2 sm:px-4 sm:py-2 text-xs sm:text-sm rounded-md transition-colors"
                          [class.bg-blue-600]="form.get('job_id')?.value === profile['id']"
                          [class.text-white]="form.get('job_id')?.value === profile['id']"
                          [class.bg-gray-100]="form.get('job_id')?.value !== profile['id']"
                          [class.hover:bg-gray-200]="form.get('job_id')?.value !== profile['id']"
                        >
                          {{ profile.name }}
                        </button>
                      </div>
                    </div>
                
                    <!-- Selected Skills -->
                    <div class="mb-4">
                      @if(selectedSkills.length > 0){
                      <label class="block text-sm font-medium text-gray-700 mb-2">Skills</label>
                      <div class="flex flex-wrap gap-2 mb-2 border border-indigo-800 rounded-lg p-5">
                        <div *ngFor="let skillCtrl of selectedSkills; let i = index"
                            class="flex items-center px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">
                            <button
                            type="button"
                            (click)="removeSkill(skillCtrl)"
                            class="ml-1 text-blue-600 flex hover:text-blue-800"
                            >
                            <img [src]="skillCtrl.icon" class="w-5 h-5 mx-3" alt="">
                            {{ skillCtrl.name }}
                            &times;
                          </button>
                        </div>
                      </div>
                      }
                    </div>
                
                    <!-- Skill Suggestions -->
                    <div class="mb-8">
                      <h3 class="text-sm font-medium text-gray-700 mb-4">Skill suggestions</h3>
                      <div class="flex flex-wrap gap-2 h-60 overflow-auto bg-slate-50">
                        <button 
                          type="button"
                          *ngFor="let skill of availableSkills"
                          (click)="addSkill(skill)"
                          class="flex items-center px-3 py-1 border rounded-full text-sm hover:bg-blue-50 hover:border-blue-200 transition-colors"
                        >
                          <span class="mr-1">+</span>
                          <img [src]="skill.icon" class="w-5 h-5 mx-3" alt="">
                          {{ skill.name }}
                        </button>
                      </div>
                    </div>
                
                    <!-- Actions -->
                    <div class="flex justify-center sm:justify-end gap-3">
                      <button
                        type="submit"
                        [disabled]="!form.valid"
                        class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors"
                      >
                        Update Skills
                      </button>
                    </div>
                  </form>
                }
                  @if(addInfo){
                  <button routerLink="/page/home" class=" float-end my-10 bg-indigo-500 text-white py-2 px-4 rounded-lg font-medium hover:bg-indigo-600 transition duration-300">
                    Complete to Main Page
                  </button>
                }

}
</div>